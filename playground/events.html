<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Events — Gravity Labs</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@300;400;500&family=DM+Sans:ital,wght@0,300;0,400;0,500;1,300&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --black: #000000;
    --white: #ffffff;
    --gray: #888888;
    --gray-dark: #333333;
    --gray-light: #cccccc;
    --font-sans: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
    --font-mono: 'DM Mono', monospace;
  }

  html { scroll-behavior: smooth; }

  body {
    font-family: var(--font-sans);
    background-color: var(--black);
    color: var(--white);
    font-size: 16px;
    line-height: 1.6;
    font-weight: 300;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  ::selection { background: var(--white); color: var(--black); }

  a { color: var(--white); text-decoration: none; transition: opacity 0.2s ease; }
  a:hover { opacity: 0.6; }

  /* Header */
  header {
    position: fixed; top: 0; left: 0; right: 0; z-index: 100;
    padding: 24px 40px;
    display: flex; justify-content: space-between; align-items: center;
    background-color: var(--black);
  }
  .logo { font-size: 18px; font-weight: 500; letter-spacing: -0.02em; }
  header nav { display: flex; gap: 32px; }
  header nav a { font-size: 14px; font-weight: 400; letter-spacing: 0.01em; }
  header nav a.active { opacity: 0.6; }

  /* Page */
  .page { padding: 120px 40px 80px; max-width: 960px; margin: 0 auto; }

  .section-label {
    font-family: var(--font-mono); font-size: 12px; color: var(--gray);
    letter-spacing: 0.05em; margin-bottom: 8px; text-transform: uppercase;
  }

  h1 {
    font-size: clamp(40px, 8vw, 72px); font-weight: 300;
    letter-spacing: -0.03em; line-height: 1.1; max-width: 900px; margin-bottom: 10px;
  }

  .page-intro {
    font-size: 18px; line-height: 1.7; color: var(--gray-light);
    max-width: 640px; margin-bottom: 6px;
  }

  .origin-info {
    font-family: var(--font-mono); font-size: 13px; color: var(--gray);
    letter-spacing: 0.02em;
  }

  /* Controls */
  .controls-section {
    margin-top: 20px; padding-top: 16px; border-top: 1px solid var(--gray-dark);
  }

  .search-input {
    width: 100%; background: transparent;
    border: none; border-bottom: 1px solid var(--gray-dark);
    color: var(--white); font-family: var(--font-sans);
    font-size: 18px; font-weight: 300; padding: 8px 0;
    letter-spacing: -0.01em; outline: none;
    transition: border-color 0.2s ease; margin-bottom: 14px;
  }
  .search-input::placeholder { color: var(--gray); font-weight: 300; }
  .search-input:focus { border-color: var(--white); }

  .filter-row {
    display: flex; align-items: baseline; gap: 24px;
    margin-bottom: 8px; flex-wrap: wrap;
  }

  .filter-label {
    font-family: var(--font-mono); font-size: 12px; color: var(--gray);
    letter-spacing: 0.05em; text-transform: uppercase; min-width: 48px;
  }

  .filter-btn {
    background: none; border: none; color: var(--gray);
    font-family: var(--font-sans); font-size: 14px; font-weight: 400;
    letter-spacing: 0.01em; cursor: pointer; padding: 4px 0;
    transition: color 0.2s ease;
  }
  .filter-btn:hover { color: var(--gray-light); }
  .filter-btn.active { color: var(--white); }

  .sort-btn {
    background: none; border: none; color: var(--gray);
    font-family: var(--font-mono); font-size: 12px;
    letter-spacing: 0.05em; text-transform: uppercase;
    cursor: pointer; padding: 4px 0; transition: color 0.2s ease;
    margin-left: auto;
  }
  .sort-btn:hover { color: var(--white); }

  .results-count {
    font-family: var(--font-mono); font-size: 12px; color: var(--gray);
    letter-spacing: 0.02em; padding: 10px 0 0;
  }

  /* Events */
  .events-list { margin-top: 8px; }

  .month-divider {
    padding: 48px 0 16px;
    font-family: var(--font-mono); font-size: 12px; color: var(--gray);
    letter-spacing: 0.05em; text-transform: uppercase;
  }

  .event-card {
    border-top: 1px solid var(--gray-dark); padding: 32px 0;
    display: grid; grid-template-columns: 72px 1fr; gap: 32px;
    opacity: 0; transform: translateY(6px);
    animation: fadeIn 0.3s ease forwards;
  }
  @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

  .event-date { text-align: right; padding-top: 4px; }
  .event-date-day { font-size: 28px; font-weight: 300; letter-spacing: -0.02em; line-height: 1; }
  .event-date-month { font-family: var(--font-mono); font-size: 12px; color: var(--gray); letter-spacing: 0.02em; margin-top: 6px; }

  .event-meta { display: flex; align-items: center; gap: 16px; margin-bottom: 12px; flex-wrap: wrap; }
  .event-tag { font-family: var(--font-mono); font-size: 12px; color: var(--gray); letter-spacing: 0.02em; }
  .event-tag::after { content: "·"; margin-left: 16px; color: var(--gray-dark); }
  .event-tag:last-child::after { display: none; }

  .event-title { font-size: 24px; font-weight: 400; letter-spacing: -0.01em; margin-bottom: 10px; line-height: 1.3; }
  .event-desc { font-size: 15px; line-height: 1.7; color: var(--gray-light); max-width: 600px; margin-bottom: 16px; }

  .event-details { display: flex; align-items: center; gap: 24px; flex-wrap: wrap; }
  .event-venue { font-size: 14px; color: var(--gray-light); }
  .event-distance { font-family: var(--font-mono); font-size: 12px; color: var(--gray); letter-spacing: 0.02em; }

  .event-links { display: flex; gap: 20px; margin-top: 16px; }
  .event-links a,
  .event-links button {
    font-size: 14px; font-weight: 400; color: var(--white);
    border-bottom: 1px solid var(--gray-dark); padding-bottom: 2px;
    transition: border-color 0.2s ease, opacity 0.2s ease;
    background: none; border-top: none; border-left: none; border-right: none;
    cursor: pointer; font-family: var(--font-sans);
  }
  .event-links a:hover,
  .event-links button:hover { border-bottom-color: var(--white); opacity: 1; }

  .empty-state { padding: 80px 0; text-align: center; font-size: 18px; color: var(--gray); font-weight: 300; }

  /* Toast */
  .toast {
    position: fixed; bottom: 40px; left: 50%;
    transform: translateX(-50%) translateY(60px);
    background: var(--white); color: var(--black);
    font-family: var(--font-mono); font-size: 13px; font-weight: 500;
    letter-spacing: 0.02em; padding: 12px 28px;
    opacity: 0; transition: all 0.3s ease; z-index: 200; pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

  /* Footer */
  footer {
    padding: 40px; border-top: 1px solid var(--gray-dark);
    display: flex; justify-content: space-between; align-items: center;
    flex-wrap: wrap; gap: 24px; max-width: 960px; margin: 80px auto 0;
  }
  footer .copyright { font-size: 13px; color: var(--gray); }
  footer nav { display: flex; gap: 24px; }
  footer nav a { font-size: 13px; color: var(--gray); }

  /* Responsive */
  @media (max-width: 768px) {
    header { padding: 20px 24px; }
    header nav { display: none; }
    .page { padding: 100px 24px 60px; }
    .event-card { grid-template-columns: 1fr; gap: 8px; }
    .event-date { text-align: left; display: flex; align-items: baseline; gap: 10px; }
    .event-date-month { margin-top: 0; }
    footer { padding: 32px 24px; flex-direction: column; align-items: flex-start; }
    footer nav { flex-wrap: wrap; gap: 16px; }
    .filter-row { gap: 16px; }
    .sort-btn { margin-left: 0; }
    .controls-section { margin-top: 16px; padding-top: 12px; }
  }
</style>
</head>
<body>

<header>
  <a href="https://gravity-labs.xyz/" class="logo">Gravity Labs</a>
  <nav>
    <a href="https://gravity-labs.xyz/about.html">About</a>
    <a href="https://gravity-labs.xyz/people.html">People</a>
    <a href="https://gravity-labs.xyz/portfolio.html">Portfolio</a>
    <a href="https://gravity-labs.xyz/collaborate.html">Collaborate</a>
    <a href="https://gravity-labs.xyz/writing.html">Resources</a>
    <a href="#" class="active">Events</a>
  </nav>
</header>

<div class="page">
  <span class="section-label">NYC Crypto Events · 2026</span>
  <h1>NYC Crypto Events</h1>
  <p class="page-intro">Conferences, meetups, and happy hours across the crypto ecosystem in NYC. Curated for founders, investors, and builders.</p>
  <p class="origin-info">Distances measured from 55 Water St, Brooklyn</p>

  <div class="controls-section">
    <input type="text" class="search-input" id="search" placeholder="Search events...">

    <div class="filter-row">
      <span class="filter-label">Size</span>
      <button class="filter-btn active" data-filter="size" data-val="all">All</button>
      <button class="filter-btn" data-filter="size" data-val="conference">Conferences</button>
      <button class="filter-btn" data-filter="size" data-val="meetup">Meetups</button>
      <button class="filter-btn" data-filter="size" data-val="happy-hour">Happy Hours</button>
    </div>

    <div class="filter-row">
      <span class="filter-label">Price</span>
      <button class="filter-btn active" data-filter="price" data-val="all">All</button>
      <button class="filter-btn" data-filter="price" data-val="free">Free</button>
      <button class="filter-btn" data-filter="price" data-val="paid">Paid</button>
      <span style="flex:1"></span>
      <button class="sort-btn" id="sort-btn">↑ Soonest first</button>
    </div>

    <div class="results-count" id="results-count"></div>
  </div>

  <div class="events-list" id="events-list"></div>
  <div class="empty-state" id="empty" style="display:none;">No events match your filters.</div>
</div>

<footer>
  <span class="copyright">© 2026 Gravity Labs. All rights reserved.</span>
  <nav>
    <a href="https://gravity-labs.xyz/about.html">About</a>
    <a href="https://gravity-labs.xyz/collaborate.html">Collaborate</a>
    <a href="https://gravity-labs.xyz/writing.html">Resources</a>
  </nav>
</footer>

<div class="toast" id="toast">Added to calendar</div>

<script>
const ORIGIN = { lat: 40.7033, lng: -73.9862 };
const EVENTS = [
  { title: "CryptoMondays NYC", date: "2026-02-09", endDate: null, size: "meetup", price: "free", description: "Weekly crypto community meetup with fireside chat on the role of state AGs in crypto policy. Free drink ticket and POAP NFT for attendees.", venue: "La Diaspora, 91 Baxter St, Chinatown", lat: 40.7158, lng: -74.0003, url: "https://www.meetup.com/cryptomondaysnyc/" },
  { title: "Where Is the Money At? Bitcoin, Stablecoin, RWA", date: "2026-02-13", endDate: null, size: "meetup", price: "paid", description: "Evening event at the Solana Skyline space covering Bitcoin market dynamics, stablecoin infrastructure, and real-world asset tokenization.", venue: "Solana Skyline, NYC", lat: 40.7425, lng: -73.9886, url: "https://allevents.in/new-york/where-is-the-money-at-bitcoin-stablecoin-rwa-solana-skyline/100001982073562381" },
  { title: "NYC Blockchain Network Monthly Meetup", date: "2026-02-19", endDate: null, size: "meetup", price: "free", description: "Every-third-Thursday gathering of NYC's crypto and blockchain community. Name tags, speed intros, and four hours of open networking.", venue: "Trump Tower, Midtown", lat: 40.7624, lng: -73.9738, url: "https://www.eventbrite.com/e/nyc-blockchain-network-meetup-the-hugh-tickets-269861301417" },
  { title: "CryptoMondays NYC", date: "2026-02-23", endDate: null, size: "meetup", price: "free", description: "Weekly crypto community meetup with fireside chats, free drink tickets, and POAP NFTs for attendees. Regular speakers from policy and industry.", venue: "La Diaspora, 91 Baxter St, Chinatown", lat: 40.7158, lng: -74.0003, url: "https://www.meetup.com/cryptomondaysnyc/" },
  { title: "Integrating Blockchain and AI Workshop", date: "2026-02-26", endDate: null, size: "meetup", price: "paid", description: "Hands-on workshop exploring the intersection of blockchain infrastructure and AI systems. Use cases in decentralized compute, on-chain ML, and autonomous agents.", venue: "Midtown Manhattan", lat: 40.7549, lng: -73.9840, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "NYC Blockchain Network Monthly Meetup", date: "2026-03-19", endDate: null, size: "meetup", price: "free", description: "Monthly gathering of NYC's crypto and blockchain community. Casual networking, demo presentations, and discussions on DeFi, NFTs, and Web3.", venue: "Trump Tower, Midtown", lat: 40.7624, lng: -73.9738, url: "https://www.eventbrite.com/e/nyc-blockchain-network-meetup-the-hugh-tickets-269861301417" },
  { title: "CryptoMondays NYC", date: "2026-03-23", endDate: null, size: "meetup", price: "free", description: "Weekly crypto community meetup with fireside chats, free drink tickets, and POAP NFTs for attendees. Regular speakers from policy and industry.", venue: "La Diaspora, 91 Baxter St, Chinatown", lat: 40.7158, lng: -74.0003, url: "https://www.meetup.com/cryptomondaysnyc/" },
  { title: "Digital Asset Summit (DAS) 2026", date: "2026-03-24", endDate: "2026-03-26", size: "conference", price: "paid", description: "Blockworks' premier institutional crypto conference. Conversations between institutions and investors on digital assets, DeFi, and stablecoins. SEC and CFTC speakers.", venue: "Midtown Manhattan", lat: 40.7549, lng: -73.9840, url: "https://blockworks.co/event/digital-asset-summit-nyc-2026" },
  { title: "Chainalysis Links NYC 2026", date: "2026-03-31", endDate: "2026-04-01", size: "conference", price: "paid", description: "Presentations, case studies, and keynotes from public and private sector crypto leaders. Experts from financial institutions, government agencies, and DeFi.", venue: "New York City", lat: 40.7484, lng: -73.9856, url: "https://www.chainalysis.com/links-nyc/" },
  { title: "Certified DeFi Associate — NYC Cohort", date: "2026-05-12", endDate: null, size: "meetup", price: "paid", description: "Certification workshop covering DeFi protocols, yield strategies, liquidity pools, smart contract auditing, and decentralized governance.", venue: "Midtown Manhattan", lat: 40.7549, lng: -73.9840, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "Investment, Trade & Crypto Networking Happy Hour", date: "2026-05-20", endDate: null, size: "happy-hour", price: "paid", description: "Happy hour for investors, traders, and crypto enthusiasts. Tables organized by industry. Ticket includes a taco and drink.", venue: "NYC bar (rotating venues)", lat: 40.7484, lng: -73.9856, url: "https://www.meetup.com/dc-investo/events/qghwxgydclbnb/" },
  { title: "WAGMI-Connect: Crypto & Macro Economics", date: "2026-06-05", endDate: null, size: "meetup", price: "free", description: "Networking event bridging macro economics with crypto markets. Monetary policy impact on digital assets, stablecoin economics, and cross-market strategies.", venue: "NYC — Venue TBA", lat: 40.7484, lng: -73.9856, url: "https://www.eventbrite.com/d/ny--new-york/fintech/" },
  { title: "ETHGlobal New York 2026", date: "2026-06-12", endDate: "2026-06-14", size: "conference", price: "free", description: "Ethereum hackathon and builder event. Workshops, mentorship, happy hours, coworking spaces, and community meetups. For beginners and experienced devs.", venue: "New York City", lat: 40.7484, lng: -73.9856, url: "https://events.coinpedia.org/ethglobal-new-york-2026-7997/" },
  { title: "NFT.NYC 2026", date: "2026-06-15", endDate: "2026-06-17", size: "conference", price: "paid", description: "The world's leading NFT conference. Digital collectibles, blockchain gaming, DeFi integration, metaverse, and the Web3 creator economy.", venue: "New York City", lat: 40.7549, lng: -73.9840, url: "https://www.nft.nyc/" },
  { title: "ETHConf New York 2026", date: "2026-07-14", endDate: "2026-07-16", size: "conference", price: "paid", description: "Three-day event for Ethereum founders, builders, and industry leaders. 5,000+ attendees exploring the future of building on Ethereum.", venue: "New York City", lat: 40.7484, lng: -73.9856, url: "https://www.splunk.com/en_us/blog/learn/blockchain-conferences-events.html" },
  { title: "DeFi & Drinks — Summer Edition", date: "2026-07-30", endDate: null, size: "happy-hour", price: "free", description: "Casual summer happy hour for DeFi builders, traders, and enthusiasts. No speakers — just drinks, conversations, and connecting with the NYC crypto community.", venue: "Rooftop bar, Lower East Side", lat: 40.7185, lng: -73.9879, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "Tokenization of Real World Assets Workshop", date: "2026-08-10", endDate: null, size: "meetup", price: "paid", description: "Workshop on tokenizing real estate, commodities, and securities on blockchain. Regulatory frameworks and smart contract architectures.", venue: "Midtown Manhattan", lat: 40.7549, lng: -73.9840, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "Blockchain Builders After-Work Social", date: "2026-09-18", endDate: null, size: "happy-hour", price: "free", description: "After-work social for blockchain developers and enthusiasts. Timed to follow major fintech conferences. Casual drinks and networking.", venue: "Bar near Midtown venue (TBA)", lat: 40.7549, lng: -73.9840, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "Women in Digital Assets Forum 2026", date: "2026-09-25", endDate: null, size: "meetup", price: "free", description: "Forum empowering women in digital assets, blockchain, and Web3. Panels, fireside chats, and networking with female leaders.", venue: "Midtown Manhattan", lat: 40.7549, lng: -73.9840, url: "https://www.eventbrite.com/d/ny--new-york/cryptocurrency/" },
  { title: "Stand With Crypto NYC — Community Happy Hour", date: "2026-10-15", endDate: null, size: "happy-hour", price: "free", description: "Community happy hour to connect local crypto advocates, discuss policy updates, and meet fellow builders. Part of the Stand With Crypto movement.", venue: "NYC bar (TBA)", lat: 40.7484, lng: -73.9856, url: "https://www.standwithcrypto.org/events" },
  { title: "The Bridge 2026", date: "2026-10-27", endDate: null, size: "conference", price: "paid", description: "The Tie's fourth annual conference on the convergence of institutional finance and digital assets. Private, invitation-only for senior executives.", venue: "Convene Brookfield Place, FiDi", lat: 40.7128, lng: -74.0152, url: "https://bridge.thetie.io/" },
  { title: "Empowering Finance Through DeFi — Workshop & Mixer", date: "2026-11-06", endDate: null, size: "meetup", price: "free", description: "Half-day workshop on DeFi applications in traditional finance, followed by an informal networking mixer. Beginner-friendly with hands-on demos.", venue: "NYC — Venue TBA", lat: 40.7484, lng: -73.9856, url: "https://www.eventbrite.com/d/ny--new-york/finance/" }
];

let sizeFilter = "all", priceFilter = "all", searchQuery = "", sortAsc = true;
const eventsList = document.getElementById("events-list");
const emptyEl = document.getElementById("empty");
const resultsCount = document.getElementById("results-count");
const searchInput = document.getElementById("search");
const sortBtn = document.getElementById("sort-btn");
const toast = document.getElementById("toast");
const monthNames = ["January","February","March","April","May","June","July","August","September","October","November","December"];
const monthShort = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
function parseDate(d) { return new Date(d + "T00:00:00"); }

function haversine(lat1, lng1, lat2, lng2) {
  const R = 3958.8, dLat = (lat2-lat1)*Math.PI/180, dLng = (lng2-lng1)*Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLng/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}
function getDistance(ev) { return haversine(ORIGIN.lat, ORIGIN.lng, ev.lat, ev.lng); }
function estimateTransit(mi) { return mi < 0.5 ? "~5 min walk" : mi < 1.2 ? "~12 min walk" : `~${Math.round(mi*3+10)} min transit`; }
function mapsUrl(ev) { return `https://www.google.com/maps/dir/${ORIGIN.lat},${ORIGIN.lng}/${ev.lat},${ev.lng}/@${ev.lat},${ev.lng},14z/data=!4m2!4m1!3e3`; }

function pad2(n) { return String(n).padStart(2,'0'); }
function generateICS(ev) {
  const uid = `${ev.date}-${ev.title.replace(/\W+/g,'-').toLowerCase()}@gravitylabs`;
  const dtStart = ev.date.replace(/-/g,'');
  const end = parseDate(ev.endDate||ev.date); end.setDate(end.getDate()+1);
  const dtEnd = `${end.getFullYear()}${pad2(end.getMonth()+1)}${pad2(end.getDate())}`;
  const now = new Date();
  const stamp = `${now.getFullYear()}${pad2(now.getMonth()+1)}${pad2(now.getDate())}T${pad2(now.getHours())}${pad2(now.getMinutes())}${pad2(now.getSeconds())}Z`;
  const esc = s => s.replace(/,/g,'\\,').replace(/;/g,'\\;').replace(/\n/g,'\\n');
  return ['BEGIN:VCALENDAR','VERSION:2.0','PRODID:-//GravityLabs//EN','CALSCALE:GREGORIAN','METHOD:PUBLISH','BEGIN:VEVENT',`UID:${uid}`,`DTSTAMP:${stamp}`,`DTSTART;VALUE=DATE:${dtStart}`,`DTEND;VALUE=DATE:${dtEnd}`,`SUMMARY:${esc(ev.title)}`,`DESCRIPTION:${esc(ev.description)}\\n\\n${ev.url}`,`LOCATION:${esc(ev.venue)}`,`URL:${ev.url}`,'STATUS:CONFIRMED','END:VEVENT','END:VCALENDAR'].join('\r\n');
}
function downloadICS(ev) {
  const blob = new Blob([generateICS(ev)],{type:'text/calendar;charset=utf-8'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url;
  a.download = `${ev.title.replace(/[^a-zA-Z0-9]/g,'_')}.ics`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a);
  URL.revokeObjectURL(url);
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2200);
}

function getFiltered() {
  return EVENTS.filter(e => {
    if (sizeFilter !== "all" && e.size !== sizeFilter) return false;
    if (priceFilter !== "all" && e.price !== priceFilter) return false;
    if (searchQuery) { const q = searchQuery.toLowerCase(); return e.title.toLowerCase().includes(q) || e.description.toLowerCase().includes(q) || e.venue.toLowerCase().includes(q); }
    return true;
  }).sort((a,b) => { const da = parseDate(a.date), db = parseDate(b.date); return sortAsc ? da-db : db-da; });
}

const sizeLabels = { "conference": "Conference", "meetup": "Meetup", "happy-hour": "Happy Hour" };

function render() {
  eventsList.innerHTML = ""; emptyEl.style.display = "none";
  const filtered = getFiltered();
  resultsCount.textContent = `${filtered.length} event${filtered.length !== 1 ? 's' : ''}`;
  if (!filtered.length) { emptyEl.style.display = "block"; return; }

  let lastMonth = "";
  filtered.forEach((ev, idx) => {
    const dt = parseDate(ev.date);
    const mk = `${dt.getFullYear()}-${dt.getMonth()}`;
    if (mk !== lastMonth) {
      lastMonth = mk;
      const d = document.createElement("div"); d.className = "month-divider";
      d.textContent = `${monthNames[dt.getMonth()]} ${dt.getFullYear()}`;
      eventsList.appendChild(d);
    }
    const card = document.createElement("div"); card.className = "event-card";
    card.style.animationDelay = `${Math.min(idx,12)*0.04}s`;
    const miles = getDistance(ev);
    const milesStr = miles < 0.1 ? "<0.1" : miles.toFixed(1);
    const tags = [sizeLabels[ev.size], ev.price === "free" ? "Free" : "Paid", ev.endDate ? "Multi-day" : null].filter(Boolean);

    card.innerHTML = `
      <div class="event-date">
        <div class="event-date-day">${dt.getDate()}</div>
        <div class="event-date-month">${monthShort[dt.getMonth()]}</div>
      </div>
      <div class="event-body">
        <div class="event-meta">${tags.map(t => `<span class="event-tag">${t}</span>`).join('')}</div>
        <div class="event-title">${ev.title}</div>
        <div class="event-desc">${ev.description}</div>
        <div class="event-details">
          <span class="event-venue">${ev.venue}</span>
          <span class="event-distance">${milesStr} mi · ${estimateTransit(miles)}</span>
        </div>
        <div class="event-links">
          <a href="${ev.url}" target="_blank" rel="noopener">Details</a>
          <a href="${mapsUrl(ev)}" target="_blank" rel="noopener">Directions</a>
          <button data-idx="${idx}">Add to Calendar</button>
        </div>
      </div>`;
    eventsList.appendChild(card);
  });

  document.querySelectorAll('.event-links button[data-idx]').forEach(btn => {
    btn.addEventListener("click", e => { e.stopPropagation(); const f = getFiltered(); const ev = f[parseInt(btn.dataset.idx)]; if (ev) downloadICS(ev); });
  });
}

document.querySelectorAll('.filter-btn[data-filter="size"]').forEach(btn => {
  btn.addEventListener("click", () => { document.querySelectorAll('.filter-btn[data-filter="size"]').forEach(b => b.classList.remove("active")); btn.classList.add("active"); sizeFilter = btn.dataset.val; render(); });
});
document.querySelectorAll('.filter-btn[data-filter="price"]').forEach(btn => {
  btn.addEventListener("click", () => { document.querySelectorAll('.filter-btn[data-filter="price"]').forEach(b => b.classList.remove("active")); btn.classList.add("active"); priceFilter = btn.dataset.val; render(); });
});
let debounce;
searchInput.addEventListener("input", e => { clearTimeout(debounce); debounce = setTimeout(() => { searchQuery = e.target.value.trim(); render(); }, 200); });
sortBtn.addEventListener("click", () => { sortAsc = !sortAsc; sortBtn.textContent = sortAsc ? "↑ Soonest first" : "↓ Latest first"; render(); });
render();
</script>
</body>
</html>
